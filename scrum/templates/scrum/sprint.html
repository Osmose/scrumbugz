{% extends "base.html" %}

{% block content %}
  <div class="row">
    <div class="span12">
      <h1><a href="{{ project.get_absolute_url }}">{{ project.name }}</a> &mdash; {{ sprint.name }}</h1>
    </div>
  </div>
  <div class="row">
    <div class="span3">
      <h2>Numbers</h2>
      <dl>
        <dt>Total Points:</dt>
        <dd>{{ bugs_data.total_points }}</dd>
        <dt>Total Stories:</dt>
        <dd>{{ bugs|length }}</dd>
        {% for k, v in bugs_data.basic_status.items %}
          <dt>{{ k|capfirst }} Points:</dt>
          <dd><strong>{{ v }}</strong></dd>
        {% endfor %}
      </dl>
    </div>
    <div class="span9">
      <h2>Burninate!!!</h2>
      <div id="burndown"></div>
    </div>
  </div>
  <div class="row">
    <div class="span3">
      <h2>Status</h2>
      <div class="piegraph" id="status-pie"></div>
    </div>
    <div class="span3">
      <h2>Component</h2>
      <div class="piegraph" id="component-pie"></div>
    </div>
    <div class="span3">
      <h2>Story User</h2>
      <div class="piegraph" id="user-pie"></div>
    </div>
  </div>
  <div class="row">
    <div class="span12">
      <table class="table table-striped table-condensed">
        <thead>
          <tr>
            <th>ID</th>
            <th>Summary</th>
            <th>Assigned To</th>
            <th>Story User</th>
            <th>Component</th>
            <th>Points</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for bug in bugs %}
            <tr data-bugid="{{ bug.id }}" id="bug{{ bug.id }}">
              <td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id={{ bug.id }}">{{ bug.id }}</a></td>
              <td>{{ bug.summary }}</td>
              <td>{{ bug.assigned_to.real_name }}</td>
              <td>{{ bug.user }}</td>
              <td>{{ bug.component }}</td>
              <td>{{ bug.points }}</td>
              <td>{{ bug.status }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}

{% block js %}
  <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.flot.min.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.flot.pie.min.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.flot.resize.min.js"></script>
  <script type="text/javascript">
    $(function(){
      "use strict";
      var BUGS_DATA = {{ bugs_data_json|safe }};
      var resize_graphs = function(){
        $('div.piegraph').css('height', function(){
          return $(this).css('width');
        });
        $('#burndown').css('height', function(){
          return parseInt($(this).css('width'))/2;
        });
      };
      $('#burndown').on('resize', resize_graphs);
      resize_graphs();

      $.plot($('#burndown'), [BUGS_DATA.burndown], {
        xaxis: {
          mode: 'time',
          ticks: BUGS_DATA.burndown_axis
        },
        yaxis: {
          min: 0,
          tickSize: 2
        },
        lines: {
          show: true,
          fill: 0.4
        },
        points: {
          show: true,
          fill: false
        }
      });
    });
  </script>
{% endblock %}
